{{ define "main" }}
{{ $image := .Resources.GetMatch "cover" | default (index (.Resources.ByType "image") 0) }}

{{/* En-tête enrichi */}}
<header class="article-header max-w-4xl my-12 mx-8 md:mx-auto text-left">
  {{/* Catégorie */}}
  {{ with .Params.categories }}
    <a href="/{{ index . 0 | urlize }}/" class="article-category text-sm uppercase tracking-widest opacity-50">{{ index . 0 }}</a>
  {{ end }}

  {{/* Titre */}}
  <h1 class="article-title text-2xl md:text-4xl my-4 mt-6">{{ .Params.emoji }} {{ .Title }}</h1>

  {{/* Chapô optionnel */}}
  {{ with .Params.subtitle }}
    <p class="article-chapo text-lg opacity-80 italic mt-2">{{ . }}</p>
  {{ end }}

  {{/* Date */}}
  <p class="article-date text-xs opacity-40 mt-6">{{ .Date.Day }} {{ index .Site.Data.mois (printf "%d" .Date.Month) }} {{ .Date.Year }}</p>

  <hr class="article-separator my-6 w-full border-gray-300">
</header>

{{/* Contenu de l'article */}}
<div data-pswp class="main post article-post max-w-4xl mx-8 md:mx-auto">
  {{ if .IsTranslated }}
    {{ range .Translations }}
    <p class="translation en">
      <a href="{{ .Permalink }}">{{ T "also_available" }} {{ .Language.LanguageName }}</a>
    </p>
    {{ end}}
  {{ end }}

  {{ partial "gallery.html" . }}

  {{.Content}}

  {{if .Params.gear }}
    <p class="center t12"><i>Gear: </i>{{ delimit .Params.gear " ● " }}</p>
  {{ end }}

  <hr class="my-8 border-gray-200">
  <p class="text-sm opacity-70">
    PS: Pour prolonger → mon podcast <a href="/podcast/">Slow is Beautiful</a><br>
    et <a href="/essentiels/">ma page essentiels</a> pour les curieux.
  </p>
</div>

{{/* Navigation prev/next */}}
<nav class="article-nav max-w-4xl mx-8 md:mx-auto my-12">
  <hr class="my-8 border-gray-300">
  <div class="flex justify-between items-center">
    {{ with .PrevInSection }}
      <a href="{{ .Permalink }}" class="nav-prev text-sm opacity-70 hover:opacity-100">← {{ .Title | truncate 30 }}</a>
    {{ else }}
      <span></span>
    {{ end }}
    {{ with .NextInSection }}
      <a href="{{ .Permalink }}" class="nav-next text-sm opacity-70 hover:opacity-100">{{ .Title | truncate 30 }} →</a>
    {{ else }}
      <span></span>
    {{ end }}
  </div>
</nav>

{{ end }}
